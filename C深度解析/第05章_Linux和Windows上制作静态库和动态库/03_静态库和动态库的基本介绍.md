# 2. 库的原理
原理很简单，先将要复用的源码.c编译为对应的.o，然后再将所有的.o打包做成“库”文件。
	
	fuyong1.c --------------------> fuyong1.o--\  “打包”
	...       			...         >———————> 库文件
	fuyongn.c --------------------> fuyongn.o--/ 
	
	
使用时，直接链接“库文件”即可，在程序中调用了某个函数，链接库文件时会自动帮我搜索这个函数在库中的哪些.o中，然后就链接库中这些.o  

做成真正的库文件有如下好处：  
+ 1）不需要公开源码，维护了版权
+ 2）不需要浪费额外的编译时间，因为事先就编译好了，只需要链接即可
+ 3）也不需要人为的挑选.o，链接库时会自动的搜素。
				
# 3. 库文件的尾缀
库分为两种，静态库 和 动态库  
静态库和动态库文件的尾缀，与编译器和操作系统都有关  
	
## 3.1 静态库
总的来说，静态库的尾缀是由平台来决定的
+  windows平台：静态库的结尾为.lib 
+  Linux平台：静态库的结尾为.a 

但实际上静态库文件是以.a结尾还是.lib结尾，与编译器也有关，比如gcc编译器，不管编译得到静态库是运行在windows上还是运行在linux上，使用gcc做出的静态库文件都是以.a结尾的  
	
	
## 3.2 动态库 
动态库名字的尾缀，基本上只与平台有关 

+  windows平台：动态库的结尾为.dll
+  Linux平台：动态库的结尾为.so

# 4. 静态库的基本介绍
## 4.1 如何得到静态库
比如得到数学库   
先编译源码得到.o，然后再将所有的.o打包为“静态库文件(libmath.a)  
![静态库的制作](https://i.loli.net/2019/03/18/5c8f15abad9b7.jpg)
	
## 4.2 如何使用静态库	
比如我写了一个c程序，里面调用到了“开方”数学函数，假设开方函数在libmath.a的kf.o中  
	
链接时，直接将kf.o中代码链接到自己的程序中  
	
“静态库”只是对所有的.o进行了打包，在连接库中.o文件，与链接一般的.o文件没有任何区别    

![链接自定义的静态库](https://i.loli.net/2019/03/18/5c8f1663a9c78.jpg)  
	
## 4.3 为什么称为静态库	
静态库也被称为静态链接库，那么什么是静态链接呢？一般情况下的链接就是“静态链接”  

		  预编译、编译、汇编               
	***.c   --------------------> ***.o--\    链接（静态链接）
	...                            ...    > ————————————————————> 可执行程序（a.exe/a.out）
	***.c   --------------------> ***.o -/


静态链接的特点是，所有的.o的代码会组合到一起，最终得到“可执行程序”会包含静态链接的所有的.o的代码  
	
	
## 4.4 静态库的缺点
由于不管有多少个程序链接了静态库，链接时都会包含一份独立的代码到程序中，当这些程序同时运行在同一台计算机上时，这些重复的代码会比较浪费存储空间  

![静态库的缺点](https://i.loli.net/2019/03/18/5c8f1814edc96.jpg)  

为了应对静态库的缺点，于是就有了动态库   
		

## 4.5 制作、使用静态库的详细过程

后面再详细介绍
				
# 5. 动态库的基本介绍		

因为静态存在缺点，所以才就有了动态库，动态库就是为了解决静态库的缺点而出现的。
	
	
## 5.1 如何得到动态库
编译源码得到.o，然后再将所有的.o打包为“动态库文件”  
![动态库的制作](https://i.loli.net/2019/03/18/5c8f357b1c71e.jpg)  
		
## 5.2 使用动态库

### 5.2.1 链接动态库

动态库也叫“动态链接库”，链接动态库过程为动态链接.  

动态链接的特点是，链接时并不会直接将库中.o文件中的代码直接链接到我们的程序中，只会对调用的“动态库的函数名”进行符号解析，告诉编译器编译时不要报错，所调用的函数定义在了动态库中.  

链接动态库后，在“可执行程序”中并不会直接包含对应的代码，只会包含对应的函数接口  

动态链接提供了一种方法，使程序可以调用不属于其“可执行程序”的函数  
	
如果被调用函数所在的.o是被静态链接到了程序中的话，调用的这个函数的代码只能在自己的程序中  

### 5.2.2 动态库的特点
	
运行链接了动态库的程序时，首先检测内存中有没有动态库代码，如果没有的话程序中的“动态库加载器”就会将所需整个动态库代码从硬盘加载到内存中，程序通过函数接口（函数名（函数指针））调用动态库的函数时，就会跳转到动态库中去调用动态库的函数代码   
	
`不管多少个程序链接了动态库，都只会留下动态库函数的接口，调用动态库函数时共享的同一个动态库的代码`，正是共享的这一特点，可以不用像静态库那样，每个程序都包含一份独立的代码，导致存储空间的浪费    

![动态库共享的特点的图示](https://i.loli.net/2019/03/18/5c8f3996220cc.jpg)  

正是由于动态库的共享特点，因此`动态库也被称为共享库`   
	
	
## 5.3 如何制作和使用动态库
后面再详细介绍。 
		
# 6. 对比动态库与静态库 

## 6.1 库知识总结

+ （1）静态库和动态库都是各种.o打包后的集合体，这个集合体就是“库文件”  
+ （2）链接静态库时，自动在库中找到xxx.o，然后将代码和自己程序的代码组合到一起   
+ （3）链接动态库时，不会将代码链接到自己的程序中，只会留下函数接口(函数指针)  
+ （4）动态库是因为静态库的缺陷而产生的，但是动态库并不能完全的替代静态库，后面会介绍原因  
      在某些情况下，我们只能使用静态库，不能使用动态库，因此动态库不可能完全替换掉静态库  
		
## 6.2 静态库、动态库 与 OS

### （1）静态库
静态库使用原理很简单，链接静态库与链接普通.o文件没有任何区别，所以不管是在裸机上，还是在有OS的计算机上，都能运行和使用静态库。
		
注：裸机就是没有OS的情况。
		
		
### （2）动态库
由于动态库是被共享的，所以`必须要有人来提供这套“共享机制”，这个机制的提供者就是OS`，所以有OS的支持才能使用动态库，而且也不是所有的OS都能提供这套“共享机制”，`只有支持“虚拟内存”机制的OS，才能提供“共享机制”`   

至于为什么“虚拟内存”能够提供这种“共享机制”，我们在“操作系统”的课程中有介绍，大家可以看这部分内容:   

在这里大家只需要记住，动态库只能基于OS运行，大多数OS比如windows、Linux、Unix、安卓等，都是支持动态库的，但是单片机上运行的小型实时OS，可能无法提供“共享机制”，因此无法使用"共享库(动态库)"  

在OS上虽然也能使用静态库，但是由于静态库的缺点很明显，所以`但凡OS只要支持动态库的话，在OS上基本只会使用动态库，只有在无法动态库的时候才会使用静态库`    

所以`在没有OS或者OS不支持共享机制时是不能使用动态库的，只能静态库，因此动态库不可能完全替换掉静态库`  
		
		
## 6.3 所有高级语言都有自己的库吗？
所有高级语言都有自己各种库，这些事先写好的库可以提高开发效率，因此某个语言受不受欢迎，与它的库丰不丰富有很大关系，因为库越丰富这门语言使用起来就越方便，开发效率越高  

在前面就介绍过，面向过程语言的库为函数库，而面向对象语言库的则为类库  
	
## 6.4 库的好处

+ （1）可以非常方便复用自己的或前人的劳动成果，以有效提高开发效率  
+ （2）库还可以用来实现软件的功能升级  
      比如给原来的程序提供新的功能库，通过这个新的库就可以升级和扩展程序的功能  

## 6.5 什么时候需要做一个库

判断条件很简单，就是当需要复用代码，而且不想以源码和.o形式来复用时，我们就可以选择做成库了。

## 6.6 各种库举例		
+  数学库：各种数学函数，比如开方、平方、sin、cos、log等等数学运算
+  GL库：Graphic Library，图形图像算法库
+  音视频库：实现音视频的编解码、滤波去噪、音视频格式转换
+  线程程库：实现多线程
+  等等
	
# 7. 实现库的难点

实现库的难点并不在于如何制作和使用库，不管你的库是大还是小，是复杂还是简单，制作和使用的规则都是一样的，没有任何差异，事实上最难的是如何实现库的标准化(规范化)  
	
所谓标准化就是，让库代码更加的健壮合理，让库函数的功能和函数接口标准化，让库被大多数的编程者所接受，这个是比较难的  

## 7.1 个人库

完全为了方便自己使用而存在的东西，库函数的规范带有很强的个人特点。

## 7.2 公司内部的库

为了方便公司产品开发而制作的库，相比个人的库会更加规范。

## 7.3 c标准库

所有使用c语言的人基本上都会使用c标准库，printf、scanf、getchar、strlen等函数，都是c标准库提供的  
	
C标准库的标准是由权威的国际性组织制定的，比如ANSI（美国国家标准学会）、ISO（国际标准化组织）、IEEE（电气和电子工程师协会）等组织  
	
这些组织会给出c标准库函数的规范化规定（比如函数功能、函数名、函数参数、返回值等）  

不过这些组织只会给出规范化规定，c标准库的实现则是由专门的开发团队来实现的，比如针对windows环境的c标准库，可能是由windows的开发团队来实现的，针对Linux的c标准库，应该是Linux维护团队GNU组织来开发的    

虽然不同环境的c标准库可能是由不同的团队来实现的，但是由于遵守相同的标准和规范，所以我们可以在不同的平台调用完全相同的c标准库函数（比如printf、scanf、sin、malloc、strcpy等），有关c标准库，我们后面会详细的介绍c标准库的基本组成  
	
	
## 7.4 与平台相关c库函数

c标准库的标准是由“国际性组织”所制定权威标准，一般情况下，不管什么平台都会完整的支持这个标准  
不过不同平台除了支持通用的c标准库函数以外，可能还会提供完全属于自己平台的c库函数，像这些C库函数其它平台是不会支持的，只能在自己的平台使用  
