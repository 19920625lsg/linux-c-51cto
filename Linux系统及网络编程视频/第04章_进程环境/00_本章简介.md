# 第5章：进程环境

## 1. 什么是进程环境

### （1）人的环境

> 人活着，就必须要有相应环境的支持，如果没有就活不下去，人活着需要的环境有哪些

+ 1）住房环境
+ 2）办公环境
+ 3）购物环境
+ 4）学习环境
+ 5）社交环境
+ 6）等等

### （2）进程环境

**进程其实就是活着的程序**(正在运行的程序)，为了更好的理解后续课程，这里我们有必要来区分一下“程序”和“进程”。

+ 1）程序  
  只不过存放在硬盘上的一个“普通文件”而已，与存放文字编码的普通文件没任何区别，只不过存放文字编码的普通文件所不同的是，程序文件（可执行文件）里面放的是可以被CPU执行的机器指令。

+ 2）进程  
  将硬盘上的程序代码拷贝到内存中，cpu从第一条指令开始，一条一条的执行程序中的所有指令代码，然后整个程序就开始运行了。

  进程在运行的过程中，跟人一样，有生（开始）、有死（结束），进程在活着时（运行时），也必须要有相应运行环境的支持，如果没有，这个程序（进程）无法运行起来，那么进程的运行环境就是“进程环境”。

+ 3）总结  
  严格意义上讲:
  + 程序，指的是存放在硬盘上的、静态的机器指令文件，所谓**静态就是没有运行**的意思
  + 进程，指的是存放于内存中，**正在被cpu执行的程序**，当然这个理解不够全面，不过目前也只能这样理解了。

## 2. 那么进程所需的运行环境有哪些？

所需环境有：

+ 启动代码
+ 环境变量
+ c程序的内存空间布局
+ 库等

### （1）启动代码

#### （a）什么是启动代码？

故名思意就是启动程序的代码  

其实所有高级语言编写的程序，都有启动代码，对于我们C语言程序来说也是如此，也有自己的启动代码  

#### （b）c程序的启动代码

大家都知道，c程序都是从main函数开始运行的，不过我们平时只看到main调用别的子函数，但是main本身作为一个函数，其实main也是需要被人调用的，被谁调用的呢？  

答：被C程序的启动代码调用的  

既然启动代码如此重要，那我们就需要认真的说说启动代码，在讲启动代码时，我们会把以下问题介绍清楚：

+ 基于裸机运行的c程序 与 基于OS运行的c程序，他们在运行是有什么区别
+ 命令行的参数是如何传递给main的形参的
+ 什么是进程的正常终止 和 异常终止，return、exit、_exit这几种返回方式有什么异同, 说到return、exit，其实在c++/java等中也有，它们的功能其实都是一样的
+ main函数调用return关键字时，到底发生了什么，返回的返回值到底返回给了谁，有什么意义

### （2）环境变量表

进程在运行的过程中需要用到环境变量，而环境变量存放在了环境表中，所以我们需要讲一讲环境变量表。

如果大家在学习java时安装过JDK的话，估计对windows的环境变量不陌生，因为安装JDK时需要设置windows的环境变量，

当然本章重点讲的是Linux的环境变量，不过为了便于理解，会与windows的环境变量进行对比介绍。

### （3）c程序的内存空间结构

c程序运行时，是运行在内存上的，也就是说需要在内存上开辟出一块空间给c程序，然后将C代码会被从硬盘拷贝到内存空间上运行，而且这段空间必须布局为c程序运行所需的空间结构，c程序才能运行，所以，c程序的内存空间结构也是必须要的“进程环境”。

比如程序在调用函数时需要用到“栈”这个东西，那么就必须在内存空间中构建出“栈”，否者c序程序没办法实现函数调用。

这就好比你租了写字楼的某层开了家公司，但是这个空间肯定是需要被布局为你要的结构的，如果空间不布局的话，你公司怎么运作起来。

所有高级语言的程序在运行时，都有自己的内存空间和空间结构，不过它们的结构都是相似的，理解了C的内存空间布局，自然也理解其它程序的内存空间结构。

有关c程序的内存空间结构，我们在《C语言深度解析》中有详细讲过，但是由于c内存空间也是“进程环境”之一，因此我们这里还会进行回顾。

### （4）库

c程序（进程）运行时，都是需要库的支持的，至于为什么需要库，学过了c语言同学，应该都非常清楚。

不仅c程序需要库的支持，其它高级语言的程序，同样需要库的支持，所以库也是非常重要的进程环境，没有库的支持，我们的程序基本做不了太过复杂的事。

有关C库这一块，我们在《C语言深度解析》这门课里面有详细讲解，比如：

+ 为什么需要库
+ 什么是静态库，什么是动态库
+ 如何制作动态库和静态库
+ 等

所以在这里，不再详细讲库这个东西，在这里大家只需要理解，库是也是非常重要的进程环境。

## 3. 本章的意义

本章的API并不多，也不复杂，当然这些API都是与进程环境相关的API，对本章来说，理解这些API是其次，更关键的还是希望大家理解什么是进程环境。

通过对本章“进程环境”的理解，希望能够有效解决大家以前很多的疑惑，比如：

+ 1）main函数是被谁调用的
+ 2）main函数的返回值返回给了谁
+ 3）main函数的参数有什么用
+ 4）什么是进程的环境变量表
+ 5）什么是程序的内存空间，程序的内存空间为什么要进行结构的布局
+ 等等
